<!doctype html>
<html class="docs-version-0.14" lang="fr" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="search" type="application/opensearchdescription+xml" title="CosmWasm Documentation" href="/fr/opensearch.xml"><title data-react-helmet="true">Contract Composition | CosmWasm Documentation</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://docs.cosmwasm.com/fr/docs/0.14/architecture/composition"><meta data-react-helmet="true" name="docsearch:language" content="fr"><meta data-react-helmet="true" name="docsearch:version" content="0.14"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-docs-0.14"><meta data-react-helmet="true" property="og:title" content="Contract Composition | CosmWasm Documentation"><meta data-react-helmet="true" name="description" content="Given the Actor model of dispatching messages, and synchronous queries implemented in CosmWasm"><meta data-react-helmet="true" property="og:description" content="Given the Actor model of dispatching messages, and synchronous queries implemented in CosmWasm"><link data-react-helmet="true" rel="icon" href="/fr/img/favicon.svg"><link data-react-helmet="true" rel="canonical" href="https://docs.cosmwasm.com/fr/docs/0.14/architecture/composition"><link data-react-helmet="true" rel="alternate" href="https://docs.cosmwasm.com/docs/0.14/architecture/composition" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.cosmwasm.com/fr/docs/0.14/architecture/composition" hreflang="fr"><link data-react-helmet="true" rel="alternate" href="https://docs.cosmwasm.com/docs/0.14/architecture/composition" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/fr/assets/css/styles.293cb3ed.css">
<link rel="preload" href="/fr/assets/js/runtime~main.5695d867.js" as="script">
<link rel="preload" href="/fr/assets/js/main.81bb3cb0.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?e("light"):e("dark")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_aKYr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://docs.cosmwasm.com/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/fr/img/logo.svg" alt="CosmWasm" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/fr/img/logo_dark.svg" alt="CosmWasm" class="themedImage_W2Cr themedImage--dark_oUvU"></div></a><a class="navbar__item navbar__link navbar__link--active" href="/fr/docs/0.14/">Docs</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" class="navbar__link">Learn</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/fr/dev-academy/intro">Dev Academy</a></li><li><a class="dropdown__link" href="/fr/tutorials/hijack-escrow/intro">Tutorials</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" class="navbar__link">dApps</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/fr/cw-plus/0.9.0/overview">cw-plus</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" class="navbar__link" docspluginid="ecosystem">Ecosystem</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/fr/ecosystem/overview">Overview</a></li><li><a class="dropdown__link" href="/fr/ecosystem/jobs">Jobs</a></li><li><a class="dropdown__link" href="/fr/ecosystem/testnets/build-requirements">Testnets</a></li><li><a class="dropdown__link" href="/fr/ecosystem/hall-of-fame">Hall of Fame</a></li><li><a class="dropdown__link" href="/fr/ecosystem/media/assets">Media</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/fr/docs/0.14/">0.14</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/fr/docs/1.0/architecture/composition">1.0</a></li><li><a class="dropdown__link" href="/fr/docs/0.16/architecture/composition">0.16</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/fr/docs/0.14/architecture/composition">0.14</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_dNtB"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>FranÃ§ais</span></span></a><ul class="dropdown__menu"><li><a href="/docs/0.14/architecture/composition" target="_self" rel="noopener noreferrer" class="dropdown__link">English</a></li><li><a href="/fr/docs/0.14/architecture/composition" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">FranÃ§ais</a></li></ul></div><div class="toggle_Pssr toggle_TdHA toggleChecked_cnQY toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ðŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ðŸŒž</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" checked="" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y sidebarWithHideableNavbar_FoYL"><a href="https://docs.cosmwasm.com/" target="_blank" rel="noopener noreferrer" tabindex="-1" class="sidebarLogo_FJUI"><img src="/fr/img/logo.svg" alt="CosmWasm" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/fr/img/logo_dark.svg" alt="CosmWasm" class="themedImage_W2Cr themedImage--dark_oUvU"></a><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fr/docs/0.14/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/fr/docs/0.14/getting-started/intro">Getting Started</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fr/docs/0.14/getting-started/intro">Your First Contract</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fr/docs/0.14/getting-started/installation">Installation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fr/docs/0.14/getting-started/setting-env">Setting Up Environment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fr/docs/0.14/getting-started/compile-contract">Downloading and Compiling Contract</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fr/docs/0.14/getting-started/interact-with-contract">Uploading and Interacting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fr/docs/0.14/getting-started/next-steps">Next Steps</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_VCh3" aria-current="page" href="/fr/docs/0.14/architecture/multichain">Architecture</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fr/docs/0.14/architecture/multichain">What are Multi-Chain Contracts?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fr/docs/0.14/architecture/actor">Actor Model</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fr/docs/0.14/architecture/addresses">Names and Addresses</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fr/docs/0.14/architecture/query">Querying</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fr/docs/0.14/architecture/serialization">Serialization</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/fr/docs/0.14/architecture/composition">Contract Composition</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fr/docs/0.14/architecture/smart-contracts">Comparison with Solidity Contracts</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/fr/docs/0.14/ibc/overview">IBC</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fr/docs/0.14/COMPATIBILITY">Compatibility</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fr/docs/0.14/MIGRATING">Migrating Contracts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fr/docs/0.14/CHANGELOG">CHANGELOG</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_cwdi"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_xORG"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->CosmWasm Documentation<!-- --> <b>0.14</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/fr/docs/1.0/architecture/composition">latest version</a></b> (<!-- -->1.0<!-- -->).</div></div><div class="docItemContainer_vinB"><article><span class="theme-doc-version-badge badge badge--secondary">Version: <!-- -->0.14</span><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Contract Composition</h1><p>Given the <a href="/fr/docs/0.14/architecture/actor">Actor model</a> of dispatching messages, and <a href="/fr/docs/0.14/architecture/query">synchronous queries</a> implemented in CosmWasm
v0.8, we have all the raw components to enable arbitrary composition of contracts with both other contracts and native
modules. Here we will explain how the components fit together and how they can be extended.</p><p><strong>Note</strong> The text below applies to CosmWasm 0.8, release May 25, 2020. Please upgrade if you wish to take advantage of
the power of composition.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="terminology">Terminology<a class="hash-link" href="#terminology" title="Direct link to heading">â€‹</a></h2><p>For the remainder of this article, I will make a key distinction between &quot;Contracts&quot; and &quot;Native Modules&quot;. &quot;Contracts&quot;
are CosmWasm code that is dynamically uploaded to the blockchain at a given address. This can be added after the fact
and is not tied to any runtime implementation.
&quot;Native Modules&quot; are basically Go Cosmos SDK modules, which are compiled into the blockchain binary. These are
relatively static (requiring a soft or hard fork to be added or modified) and will differ between different blockchains
running CosmWasm.</p><p>We support composition between both types, but we must look more deeply at the integration with &quot;Native Modules&quot;, as
using those can cause <a href="#portability">Portability</a> issues. To minimize this issue, we provide some abstractions around &quot;
Modules&quot;</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="messages">Messages<a class="hash-link" href="#messages" title="Direct link to heading">â€‹</a></h2><p>Both <code>init</code> and <code>handle</code> can return an arbitrary number of
<a href="https://github.com/CosmWasm/cosmwasm/blob/08717b4c589bbfe59f44bb8cccffb08f63696413/packages/std/src/init_handle.rs#L11-L31" target="_blank" rel="noopener noreferrer"><code>CosmosMsg</code></a>
objects, which will be re-dispatched in the same transaction (thus providing atomic success/rollback with the contract
execution). There are 3 classes of messages:</p><ul><li><code>Contract</code> - This will call a given contract address with a given message (provided in serialized form). It assumes
the caller has access to the API format.</li><li><a href="#modules">Module interfaces</a> - These are standardized interfaces that can be supported by any chain to expose native
modules under a <em>portable</em> interface.</li><li><a href="#customization"><code>Custom</code></a> - This encapsulates a chain-dependent extension to the message types to call into custom
native modules. Ideally they should be <em>immutable</em> on the same chain over time, but they make no portability
guarantees.</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="queries">Queries<a class="hash-link" href="#queries" title="Direct link to heading">â€‹</a></h2><p>As of CosmWasm v0.8, we now allow the contracts to make synchronous <em>read-only</em> queries to the surrounding runtime. As
with <a href="#messages">Messages</a>, we have three fundamental types:</p><ul><li><code>Contract</code> - This will query a given contract address with a given message (provided in serialized form). It assumes
the caller has access to the API format.</li><li><a href="#modules">Module interfaces</a> - These are standardized interfaces that can be supported by any chain to expose native
modules under a <em>portable</em> interface.</li><li><a href="#customization"><code>Custom</code></a> - This encapsulates a chain-dependent extension to to query custom native modules. Ideally
they should be <em>immutable</em> on the same chain over time, but they make no portability guarantees.</li></ul><p>Cross-Contract queries take the address of the contract and a serialized <code>QueryMsg</code> in the contract-specific format, and
synchronously get a binary serialized return value in the contract-specific format. It is up to the calling contract to
understand the appropriate formats. In order to simplify this, we can provide some contract-specific type-safe wrappers,
much in the way we provide a simple
<a href="https://github.com/CosmWasm/cosmwasm/blob/08717b4c589bbfe59f44bb8cccffb08f63696413/packages/std/src/traits.rs#L95-L105" target="_blank" rel="noopener noreferrer"><code>query_balance</code></a>
method as a wrapper around the <code>query</code> implementation provided by the Trait.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="modules">Modules<a class="hash-link" href="#modules" title="Direct link to heading">â€‹</a></h2><p>In order to enable better integrations with the native blockchain, we are providing a set of standardized module
interfaces that should work consistently among all CosmWasm chain. The most basic one is to the <code>Bank</code> module, which
provides access to the underlying native tokens. This gives us <code>BankMsg::Send</code> as well as
<code>BankQuery::Balance</code> and <code>BankQuery::AllBalances</code> to check balances and move tokens.</p><p>The second standardized module is <code>staking</code>, which provides some standardized messages for <code>Delegate</code>, <code>Undelegate</code>,
<code>Redelegate</code> and <code>Withdraw</code>, as well as querying <code>Validators</code> and <code>Delegations</code>. These interfaces are designed to
support most PoS systems and able to be supported on any PoS system, not just with the current staking module of the
Cosmos SDK.
(So, if you fork that for your chain, the contracts should still work).</p><p>This provides a clean design, where one can develop a contract that eg. issues staking derivatives using the <code>staking</code>
module interface, and have confidence that that same contract will run on two different blockchains, even if they are
both heavily customized and one is on Cosmos SDK 0.38 and the other on Cosmos SDK 0.39 (with many breaking changes). The
downside here is that every module interface must be added to all layers of the stack, which provides some delay to
supporting custom features, and we cannot easily add support for every custom module in every Cosmos SDK-based
blockchain.</p><p>That said, we highly recommend using the module interface when possible, and using <a href="#customization">custom types</a> as a
temporary measure to keep a fast release cycle. We are happy to work with projects with concrete use cases that can be
re-used between many different chains to add new standardized module interfaces. Perhaps for governance, or for
IBC/light client related features.</p><p>Note, that theoretically these module interfaces can also be implemented by contracts, not just native code. Eg. if we
made a standard <code>swap</code> interface, and your blockchain has no native <code>swap</code> module, we could upload a UniSwap-inspired
contract and register that somehow with the Go blockchain. Then the blockchain would know to take the swap message and
dispatch it to this custom contract.
(Note that this is not implemented at all, just an idea of future directions).</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="customization">Customization<a class="hash-link" href="#customization" title="Direct link to heading">â€‹</a></h2><p>Many chains will want to allow contracts to execute with their custom go modules, without going through all the work to
try to turn it into a standardized <a href="#modules">Module Interface</a> and wait for a new CosmWasm release. For this case, we
introduce the <code>Custom</code> variant on both <code>CosmosMsg</code> and <code>QueryRequest</code>. The idea here is that the contract can define the
type to be include in the <code>Custom</code> variants, and it just needs to be agreed upon by the Cosmos SDK app
(in Golang) on the other side. All the code between the contract and the blockchain codec treats it as opaque json
bytes.</p><p>The demo &quot;reflect&quot; contract in the standard CosmWasm repo,
<a href="https://github.com/CosmWasm/cosmwasm/blob/71f643f577184a23b2f1f122531c944f0de94c34/contracts/reflect/src/msg.rs#L30-L64" target="_blank" rel="noopener noreferrer">shows how to use <code>CustomMsg</code> and <code>CustomQuery</code></a>
. You can see how the
contract <a href="https://github.com/CosmWasm/cosmwasm/blob/master/contracts/reflect/src/contract.rs#L94-L101" target="_blank" rel="noopener noreferrer">uses a <code>CustomQuery</code></a>
to call out to some &quot;runtime-provided&quot; code. For unit tests, we
can <a href="https://github.com/CosmWasm/cosmwasm/blob/master/contracts/reflect/src/testing.rs#L20-L37" target="_blank" rel="noopener noreferrer">mock out the runtime querier</a>
, but in a deployed system, this should be provided by native Go code in your Cosmos SDK application.</p><p>Beyond trivial cases, we are working with Terra to expose their <code>swap</code>, <code>oracle</code> and <code>treasury</code> modules to CosmWasm
contracts on their chains. These features need to be exposed in an immutable format that will work forever on their
chain, but there is no need for portability. More interesting is the ability to quickly expose new features of their
native modules to contracts on their chain. In fact, this concrete use case inspired all the refactoring to make sure
custom messages and queries possible.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="design-considerations">Design Considerations<a class="hash-link" href="#design-considerations" title="Direct link to heading">â€‹</a></h2><p>In producing a solid design, we want the API to fulfill all these requirements (or strike a good balance if truly
impossible to achieve them all):</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="portability">Portability<a class="hash-link" href="#portability" title="Direct link to heading">â€‹</a></h3><p>The same contract should run on two distinct blockchains, with differing Golang modules, different versions of the
Cosmos SDK, or ideally, even based on different frameworks (eg. running on Substrate). This should be possible when
avoiding <code>Custom</code> messages, and checking the optional features one uses. The features are currently <code>staking</code>, which
assumes a PoS system, and <code>iterator</code>, which assumes we can do prefix scans over the storage (ie. it is a Merkle <strong>Tree</strong>
, not a Merkle <strong>Trie</strong>).</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="immutability">Immutability<a class="hash-link" href="#immutability" title="Direct link to heading">â€‹</a></h3><p>Contracts are immutable and encode the query and message formats in their bytecode. If we allowed dispatching <code>sdk.Msg</code>
in the native format
(be it json, amino or protobuf), and the format of native messages change, then the contracts would break. This may mean
that a staking module could never undelegate the tokens. If you think this is a theoretical issue, please note that
every major update of the Cosmos SDK has produced such breaking changes and has migrations for them. Migrations that
cannot be performed on immutable contracts. Thus, we need to ensure that our design provides an immutable API to a
potentially mutable runtime, which is a primary design criteria when designing the
standard <a href="#modules">module interfaces</a>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="extensibility">Extensibility<a class="hash-link" href="#extensibility" title="Direct link to heading">â€‹</a></h3><p>We should be able to add new interfaces to a contract and blockchain without needing to update any of the intermediate
layers. That is, if you are building a custom <code>superd</code> blockchain app, which imports <code>x/wasm</code> from <code>wasmd</code>, and want to
develop contracts on it that call into your custom <code>superd</code> modules, then in an ideal world, you could add those message
types to an additional <code>cw-superd</code> library that you can import in your contracts and add the callbacks to them
in <code>superd</code> Go code. <em>Without any changes</em> in <code>cosmwasm-std</code>, <code>cosmwasm-vm</code>,
<code>go-cosmwasm</code>, or <code>wasmd</code> repositories (which have a different release cycle than your app).</p><p>We provide the <a href="#customization"><code>Custom</code></a> variants to <code>CosmosMsg</code> and <code>QueryRequest</code> to enable such cases. They can
provide immutability but not portability.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="usability">Usability<a class="hash-link" href="#usability" title="Direct link to heading">â€‹</a></h2><p>We also want to make it not just secure and <em>possible</em> to compose contracts into a larger whole, but make it simple from
the developer&#x27;s perspective. This applies to both the contract authors, as well as the blockchain developers integrating
CosmWasm into their custom blockchain. And we want to make it easy to build client side applications using the
contracts.</p><p>We are using JSON encoding for the CosmWasm messages to make this simple and
export <a href="https://github.com/CosmWasm/cw-examples/tree/master/erc20/schema" target="_blank" rel="noopener noreferrer">JSON schemas</a> for every contract to
allow auto-generation of client-side codecs. We also provide <a href="https://github.com/CosmWasm/cosmjs" target="_blank" rel="noopener noreferrer">CosmJS</a>
as a easy-to-use TypeScript client library allowing access to all contracts (and bank module) on a CosmWasm-based chain.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="checking-for-support">Checking for Support<a class="hash-link" href="#checking-for-support" title="Direct link to heading">â€‹</a></h3><p>If we want to call some extensions, say to the <code>Staking</code> modules, we can compile our contract to handle that. But how do
we detect if the blockchain can support it? We want to fail on upload or instantiation of a contract, and not discover
some key functionality doesn&#x27;t work on this chain, when there is value stored in the contract.</p><p>The design decision was to you use feature flags, exposed as wasm export functions, to configure which extra features
are required by the contract. This lets the host chain inspect compatibility before allowing an upload. To do so, we
make some &quot;ghost&quot; exports like
<code>requires_staking()</code> or <code>requires_terra()</code>. This would only pass compatibility check if the runtime also exposed such
features. When instantiating <code>x/wasm.NewKeeper()</code> you can specify which features are supported.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="type-safe-wrappers">Type-Safe Wrappers<a class="hash-link" href="#type-safe-wrappers" title="Direct link to heading">â€‹</a></h3><p>When querying or calling into other contracts, we give up all the type-checks we get with native module interfaces. They
require the caller to know the details of the caller. This is the same as Ethereum. However, we can provide some &quot;
interface&quot;
wrappers that a contract could export, such that other contracts can easily call into it.</p><p>For example:</p><div class="codeBlockContainer_I0IT language-rust theme-code-block"><div class="codeBlockContent_wNvx rust"><pre tabindex="0" class="prism-code language-rust codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub struct NameService(CanonicalAddr);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">impl NameService {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  pub fn query_name(deps: &amp;Extern, name: &amp;str) -&gt; CanonicalAddr { /* .. */ }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  pub fn register(api: &amp;Api, name: &amp;str) -&gt; CosmosMsg { /* .. */ }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Rather than storing just the <code>CanonicalAddr</code> of the other contract in our configuration, we could store <code>NameService</code>,
which is a zero-cost <a href="https://doc.rust-lang.org/stable/rust-by-example/generics/new_types.html" target="_blank" rel="noopener noreferrer">&quot;newtype&quot;</a>
over the original address, with the same serialization format. However, it would provide us some type-safe helpers to
make queries against the contract, as well as produce <code>CosmosMsg</code> for registration.</p><p>Note that these type-safe wrappers are not tied to an <em>implementation</em> of a contract, but rather the contract&#x27;s <em>
interface</em>. Thus, we could create a small library with a list of standard/popular interfaces (like the ERCxxx specs)
represented with such
&quot;newtypes&quot;. A contract creator could import one of these wrappers and then easily call the contract, regardless of
implementation, as long as it supported the proper interface</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/InterWasm/docs/edit/main/docs_versioned_docs/version-0.14/03-architecture/06-composition.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/fr/docs/0.14/architecture/serialization"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Serialization</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/fr/docs/0.14/architecture/smart-contracts"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Comparison with Solidity Contracts</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#terminology" class="table-of-contents__link toc-highlight">Terminology</a></li><li><a href="#messages" class="table-of-contents__link toc-highlight">Messages</a></li><li><a href="#queries" class="table-of-contents__link toc-highlight">Queries</a></li><li><a href="#modules" class="table-of-contents__link toc-highlight">Modules</a></li><li><a href="#customization" class="table-of-contents__link toc-highlight">Customization</a></li><li><a href="#design-considerations" class="table-of-contents__link toc-highlight">Design Considerations</a><ul><li><a href="#portability" class="table-of-contents__link toc-highlight">Portability</a></li><li><a href="#immutability" class="table-of-contents__link toc-highlight">Immutability</a></li><li><a href="#extensibility" class="table-of-contents__link toc-highlight">Extensibility</a></li></ul></li><li><a href="#usability" class="table-of-contents__link toc-highlight">Usability</a><ul><li><a href="#checking-for-support" class="table-of-contents__link toc-highlight">Checking for Support</a></li><li><a href="#type-safe-wrappers" class="table-of-contents__link toc-highlight">Type-Safe Wrappers</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Related Documentation</div><ul class="footer__items"><li class="footer__item"><a href="https://cosmos.network/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Cosmos SDK<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://hub.cosmos.network/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Cosmos Hub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://docs.tendermint.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Tendermint Core<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Repositories</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/CosmWasm/cosmwasm" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>CosmWasm/cosmwasm<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/CosmWasm/wasmd" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>CosmWasm/wasmd<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/CosmWasm/cw-plus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>CosmWasm/cw-plus<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/InterWasm/cw-contracts" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>InterWasm/cw-contracts<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/InterWasm/cw-awesome" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>InterWasm/cw-awesome<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://medium.com/cosmwasm" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://docs.cosmwasm.com/chat/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/CosmWasm" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/InterWasm" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>InterWasm<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://cosmwasm.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_RC3H"><img src="/fr/img/logo_stacked.png" alt="CosmWasm Logo" class="themedImage_W2Cr themedImage--light_TfLj footer__logo"><img src="/fr/img/logo_stacked.png" alt="CosmWasm Logo" class="themedImage_W2Cr themedImage--dark_oUvU footer__logo"></a></div><div class="footer__copyright">Copyright Â© 2022 CosmWasm</div></div></div></footer></div>
<script src="/fr/assets/js/runtime~main.5695d867.js"></script>
<script src="/fr/assets/js/main.81bb3cb0.js"></script>
</body>
</html>