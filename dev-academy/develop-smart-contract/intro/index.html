<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="search" type="application/opensearchdescription+xml" title="CosmWasm Documentation" href="/opensearch.xml"><title data-react-helmet="true">Anatomy of a Smart Contract | CosmWasm Documentation</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://docs.cosmwasm.com/dev-academy/develop-smart-contract/intro"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-dev-academy-current"><meta data-react-helmet="true" property="og:title" content="Anatomy of a Smart Contract | CosmWasm Documentation"><meta data-react-helmet="true" name="description" content="A smart contract can be considered an instance of a singleton object whose internal state is persisted on the"><meta data-react-helmet="true" property="og:description" content="A smart contract can be considered an instance of a singleton object whose internal state is persisted on the"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.svg"><link data-react-helmet="true" rel="canonical" href="https://docs.cosmwasm.com/dev-academy/develop-smart-contract/intro"><link data-react-helmet="true" rel="alternate" href="https://docs.cosmwasm.com/dev-academy/develop-smart-contract/intro" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.cosmwasm.com/fr/dev-academy/develop-smart-contract/intro" hreflang="fr"><link data-react-helmet="true" rel="alternate" href="https://docs.cosmwasm.com/dev-academy/develop-smart-contract/intro" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.f19334b4.css">
<link rel="preload" href="/assets/js/runtime~main.c9b17ae1.js" as="script">
<link rel="preload" href="/assets/js/main.6f5058bf.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?e("light"):e("dark")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_RReh"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://docs.cosmwasm.com/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/logo.svg" alt="CosmWasm" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/logo_dark.svg" alt="CosmWasm" class="themedImage_TMUO themedImage--dark_uzRr"></div></a><a class="navbar__item navbar__link" href="/docs/1.0/">Docs</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link">Learn</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/dev-academy/intro">Dev Academy</a></li><li><a class="dropdown__link" href="/tutorials/hijack-escrow/intro">Tutorials</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link">dApps</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cw-plus/0.9.0/overview">cw-plus</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" docspluginid="ecosystem">Ecosystem</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/ecosystem/overview">Overview</a></li><li><a class="dropdown__link" href="/ecosystem/jobs">Jobs</a></li><li><a class="dropdown__link" href="/ecosystem/testnets/build-requirements">Testnets</a></li><li><a class="dropdown__link" href="/ecosystem/hall-of-fame">Hall of Fame</a></li><li><a class="dropdown__link" href="/ecosystem/media/assets">Media</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_EbrZ"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/dev-academy/develop-smart-contract/intro" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">English</a></li><li><a href="/fr/dev-academy/develop-smart-contract/intro" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">franÃ§ais</a></li></ul></div><div class="toggle_iYfV toggle_2i4l toggleChecked_a04y toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" checked="" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="searchBox_NKBi"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0 sidebarWithHideableNavbar_VlPv"><a href="https://docs.cosmwasm.com/" target="_blank" rel="noopener noreferrer" tabindex="-1" class="sidebarLogo_hmkv"><img src="/img/logo.svg" alt="CosmWasm" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/logo_dark.svg" alt="CosmWasm" class="themedImage_TMUO themedImage--dark_uzRr"></a><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/dev-academy/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Basics</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Smart Contract Interaction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Capture the Flag Riddlethon</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Develop Smart Contract</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/dev-academy/develop-smart-contract/intro">Anatomy of a Smart Contract</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/dev-academy/develop-smart-contract/develop">Develop Contract</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">DAO And Governance</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_eoK2"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_e+kA"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Anatomy of a Smart Contract</h1></header><p>A smart contract can be considered an instance of a singleton object whose internal state is persisted on the
blockchain. Users can trigger state changes through sending it JSON messages, and users can also query its state through
sending a request formatted as a JSON message.</p><p>As a smart contract writer, your job is to define 3 functions that define your smart contract&#x27;s interface:</p><ul><li><code>instantiate()</code>: a constructor which is called during contract instantiation to provide initial state</li><li><code>execute()</code>: gets called when a user wants to invoke a method on the smart contract</li><li><code>query()</code>: gets called when a user wants to get data out of a smart contract</li></ul><p>In this section, we&#x27;ll define our expected messages alongside their implementation.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="start-with-a-template">Start with a template<a aria-hidden="true" class="hash-link" href="#start-with-a-template" title="Direct link to heading">â€‹</a></h2><p>In your working directory, you&#x27;ll want to use <code>cargo-generate</code> to start your smart contract with the recommended folder
structure and build options:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># install cargo-generate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cargo install cargo-generate --features vendored-openssl</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cargo generate --git https://github.com/CosmWasm/cosmwasm-template.git --name my-first-contract</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd my-first-contract</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This helps get you started by providing the basic boilerplate and structure for a smart contract. You&#x27;ll find in
the <code>src/lib.rs</code> file that the standard CosmWasm entry points <code>instantiate()</code>, <code>execute()</code>, and <code>query()</code> are
properly exposed and hooked up.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="contract-state">Contract State<a aria-hidden="true" class="hash-link" href="#contract-state" title="Direct link to heading">â€‹</a></h2><p>The starting template has the basic following state:</p><ul><li>a singleton struct <code>State</code> containing:<ul><li>a 32-bit integer <code>count</code></li><li>an address <code>owner</code></li></ul></li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI rust"><pre tabindex="0" class="prism-code language-rust codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// src/state.rs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use schemars::JsonSchema;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use serde::{Deserialize, Serialize};</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use cosmwasm_std::{CanonicalAddr, Storage};</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use cosmwasm_storage::{singleton, singleton_read, ReadonlySingleton, Singleton};</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[derive(Serialize, Deserialize, Clone, Debug, PartialEq, JsonSchema)]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub struct State {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  pub count: i32,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  pub owner: Addr,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Smart contracts have the ability to keep persistent state through native LevelDB, a bytes-based key-value
store. As such, any data you wish to persist should be assigned a unique key at which the data can be indexed and later
retrieved.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI rust"><pre tabindex="0" class="prism-code language-rust codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// src/state.rs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub const STATE: Item&lt;State&gt; = Item::new(&quot;state&quot;);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In the example above, the key <code>&quot;state&quot;</code> is used as prefix.</p><p>Data can only be persisted as raw bytes, so any notion of structure or data type must be expressed as a pair of
serializing and deserializing functions. For instance, objects must be stored as bytes, so you must supply both the
function that encodes the object into bytes to save it on the blockchain, as well as the function that decodes the bytes
back into data types that your contract logic can understand. The choice of byte representation is up to you, so long as
it provides a clean, bi-directional mapping.</p><p>Fortunately, the CosmWasm team have provided utility crates such
as <a href="https://github.com/CosmWasm/cosmwasm/tree/main/packages/storage" target="_blank" rel="noopener noreferrer">cosmwasm_storage</a>, which provides convenient
high-level abstractions for data containers such as a &quot;singleton&quot; and &quot;bucket&quot;, which automatically provide
serialization and deserialization for commonly-used types such as structs and Rust numbers.</p><p>Notice how the <code>State</code> struct holds both <code>count</code> and <code>owner</code>. In addition, the <code>derive</code> attribute is applied to
auto-implement some useful traits:</p><ul><li><code>Serialize</code>: provides serialization</li><li><code>Deserialize</code>: provides deserialization</li><li><code>Clone</code>: makes our struct copyable</li><li><code>Debug</code>: enables our struct to be printed to string</li><li><code>PartialEq</code>: gives us equality comparison</li><li><code>JsonSchema</code>: auto-generates a JSON schema for us</li></ul><p><code>Addr</code> which represents a human-readable Bech32 address prefixed with <code>wasm...</code>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="instantiatemsg">InstantiateMsg<a aria-hidden="true" class="hash-link" href="#instantiatemsg" title="Direct link to heading">â€‹</a></h2><p>The <code>InstantiateMsg</code> is provided when a user creates a contract on the blockchain through a <code>MsgInstantiateContract</code>. This
provides the contract with its configuration as well as its initial state.</p><p>On the CosmWasm, the uploading of a contract&#x27;s code and the instantiation of a contract are regarded as
separate events, unlike on Ethereum. This is to allow a small set of vetted contract archetypes to exist as
multiple instances  sharing the same base code but configured with different parameters (imagine one canonical ERC20,
and multiple tokens that use its code).</p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="example">Example<a aria-hidden="true" class="hash-link" href="#example" title="Direct link to heading">â€‹</a></h3><p>For our contract, we will expect a contract creator to supply the initial state in a JSON message:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;count&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="message-definition">Message Definition<a aria-hidden="true" class="hash-link" href="#message-definition" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI rust"><pre tabindex="0" class="prism-code language-rust codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// src/msg.rs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use schemars::JsonSchema;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use serde::{Deserialize, Serialize};</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[derive(Serialize, Deserialize, Clone, Debug, PartialEq, JsonSchema)]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub struct InstantiateMsg {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  pub count: i32,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="logic">Logic<a aria-hidden="true" class="hash-link" href="#logic" title="Direct link to heading">â€‹</a></h3><p>Here we define our first entry-point, the <code>instantiate()</code>, or where the contract is instantiated and passed its <code>InstantiateMsg</code>. We
extract the count from the message and set up our initial state, where:</p><ul><li><code>count</code> is assigned the count from the message</li><li><code>owner</code> is assigned to the sender of the <code>MsgInstantiateContract</code></li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI rust"><pre tabindex="0" class="prism-code language-rust codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// src/contract.rs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[cfg_attr(not(feature = &quot;library&quot;), entry_point)]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub fn instantiate(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  deps: DepsMut,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  _env: Env,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  info: MessageInfo,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  msg: InstantiateMsg,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">) -&gt; Result&lt;Response, ContractError&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  let state = State {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    count: msg.count,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    owner: info.sender.clone(),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  };</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  set_contract_version(deps.storage, CONTRACT_NAME, CONTRACT_VERSION)?;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  STATE.save(deps.storage, &amp;state)?;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Ok(Response::new()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    .add_attribute(&quot;method&quot;, &quot;instantiate&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    .add_attribute(&quot;owner&quot;, info.sender)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    .add_attribute(&quot;count&quot;, msg.count.to_string()))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="executemsg">ExecuteMsg<a aria-hidden="true" class="hash-link" href="#executemsg" title="Direct link to heading">â€‹</a></h2><p>The <code>ExecuteMsg</code> is a JSON message passed to the <code>execute()</code> function through a <code>MsgExecuteContract</code>. Unlike the <code>InstantiateMsg</code>
, the <code>ExecuteMsg</code> can exist as several different types of messages, to account for the different types of functions that
a smart contract can expose to a user. The <code>execute()</code> function demultiplexes these different types of messages to its
appropriate message handler logic.</p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="example-1">Example<a aria-hidden="true" class="hash-link" href="#example-1" title="Direct link to heading">â€‹</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="increment">Increment<a aria-hidden="true" class="hash-link" href="#increment" title="Direct link to heading">â€‹</a></h4><p>Any user can increment the current count by 1.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;increment&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="reset">Reset<a aria-hidden="true" class="hash-link" href="#reset" title="Direct link to heading">â€‹</a></h4><p>Only the owner can reset the count to a specific number.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;reset&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;count&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="message-definition-1">Message Definition<a aria-hidden="true" class="hash-link" href="#message-definition-1" title="Direct link to heading">â€‹</a></h3><p>As for our <code>ExecuteMsg</code>, we will use an <code>enum</code> to multiplex over the different types of messages that our contract can
understand. The <code>serde</code> attribute rewrites our attribute keys in snake case and lower case, so we&#x27;ll have <code>increment</code>
and <code>reset</code> instead of <code>Increment</code> and <code>Reset</code> when serializing and deserializing across JSON.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI rust"><pre tabindex="0" class="prism-code language-rust codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// src/msg.rs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[derive(Serialize, Deserialize, Clone, Debug, PartialEq, JsonSchema)]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[serde(rename_all = &quot;snake_case&quot;)]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub enum ExecuteMsg {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Increment {},</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Reset { count: i32 },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="logic-1">Logic<a aria-hidden="true" class="hash-link" href="#logic-1" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI rust"><pre tabindex="0" class="prism-code language-rust codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// src/contract.rs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[cfg_attr(not(feature = &quot;library&quot;), entry_point)]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub fn execute(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  deps: DepsMut,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  _env: Env,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  info: MessageInfo,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  msg: ExecuteMsg,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">) -&gt; Result&lt;Response, ContractError&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  match msg {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ExecuteMsg::Increment {} =&gt; try_increment(deps),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ExecuteMsg::Reset { count } =&gt; try_reset(deps, info, count),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This is our <code>execute()</code> method, which uses Rust&#x27;s pattern matching to route the received <code>ExecuteMsg</code> to the appropriate
handling logic, either dispatching a <code>try_increment()</code> or a <code>try_reset()</code> call depending on the message received.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI rust"><pre tabindex="0" class="prism-code language-rust codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub fn try_increment(deps: DepsMut) -&gt; Result&lt;Response, ContractError&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  STATE.update(deps.storage, |mut state| -&gt; Result&lt;_, ContractError&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    state.count += 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Ok(state)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  })?;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Ok(Response::new().add_attribute(&quot;method&quot;, &quot;try_increment&quot;))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>It is quite straightforward to follow the logic of <code>try_increment()</code>. We acquire a mutable reference to the storage to
update the item located at key <code>&quot;state&quot;</code>, made accessible through the <code>STATE</code> convenience function defined in
the <code>src/state.rs</code>. We then update the present state&#x27;s count by returning an <code>Ok</code> result with the new state. Finally, we
terminate the contract&#x27;s execution with an acknowledgement of success by returning an <code>Ok</code> result with the
default <code>Response</code>.</p><p>In this example, the default <code>Response</code> is used for simplicity. However, the <code>Response</code> can be manually created to
provide the following information:</p><ul><li><code>messages</code>: a list of messages. This is where smart contracts execute other smart contracts or use native modules.</li><li><code>attributes</code>: a list of key-value pairs to define emitted SDK events that can be subscribed to by clients and parsed by block.</li><li><code>events</code>: Extra, custom events separate from the main <code>wasm</code> one. These will have <code>wasm-</code> prepended to the type.
Explorers and applications to report important events or state changes that occurred during the execution.</li><li><code>data</code>: additional data that the contract return to client.</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI rust"><pre tabindex="0" class="prism-code language-rust codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// src/contract.rs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub fn try_reset(deps: DepsMut, info: MessageInfo, count: i32) -&gt; Result&lt;Response, ContractError&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  STATE.update(deps.storage, |mut state| -&gt; Result&lt;_, ContractError&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if info.sender != state.owner {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      return Err(ContractError::Unauthorized {});</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    state.count = count;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Ok(state)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  })?;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Ok(Response::new().add_attribute(&quot;method&quot;, &quot;reset&quot;))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The logic for reset is very similar to increment -- except this time, we first check that the message sender is
permitted to invoke the reset function.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="querymsg">QueryMsg<a aria-hidden="true" class="hash-link" href="#querymsg" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="example-2">Example<a aria-hidden="true" class="hash-link" href="#example-2" title="Direct link to heading">â€‹</a></h3><p>The template contract only supports one type of <code>QueryMsg</code>:</p><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="balance">Balance<a aria-hidden="true" class="hash-link" href="#balance" title="Direct link to heading">â€‹</a></h4><p>The request:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;get_count&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Which should return:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;count&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="message-definition-2">Message Definition<a aria-hidden="true" class="hash-link" href="#message-definition-2" title="Direct link to heading">â€‹</a></h3><p>To support queries against our contract for data, we&#x27;ll have to define both a <code>QueryMsg</code> format (which represents
requests), as well as provide the structure of the query&#x27;s output -- <code>CountResponse</code> in this case. We must do this
because <code>query()</code> will send back information to the user through JSON in a structure and we must make the shape of our
response known.</p><p>Add the following to your <code>src/msg.rs</code>:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI rust"><pre tabindex="0" class="prism-code language-rust codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// src/msg.rs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[derive(Serialize, Deserialize, Clone, Debug, PartialEq, JsonSchema)]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[serde(rename_all = &quot;snake_case&quot;)]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub enum QueryMsg {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // GetCount returns the current count as a json-encoded number</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  GetCount {},</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// We define a custom struct for each query response</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[derive(Serialize, Deserialize, Clone, Debug, PartialEq, JsonSchema)]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub struct CountResponse {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  pub count: i32,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="logic-2">Logic<a aria-hidden="true" class="hash-link" href="#logic-2" title="Direct link to heading">â€‹</a></h3><p>The logic for <code>query()</code> should be similar to that of <code>execute()</code>, except that, since <code>query()</code> is called without the
end-user making a transaction, we omit the <code>env</code> argument as there is no information.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI rust"><pre tabindex="0" class="prism-code language-rust codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// src/contract.rs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[cfg_attr(not(feature = &quot;library&quot;), entry_point)]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub fn query(deps: Deps, _env: Env, msg: QueryMsg) -&gt; StdResult&lt;Binary&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  match msg {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    QueryMsg::GetCount {} =&gt; to_binary(&amp;query_count(deps)?),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fn query_count(deps: Deps) -&gt; StdResult&lt;CountResponse&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  let state = STATE.load(deps.storage)?;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Ok(CountResponse { count: state.count })</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="building-the-contract">Building the Contract<a aria-hidden="true" class="hash-link" href="#building-the-contract" title="Direct link to heading">â€‹</a></h2><p>To build your contract, run the following command. This will check for any preliminary errors before optimizing.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cargo wasm</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="optimizing-your-build">Optimizing your build<a aria-hidden="true" class="hash-link" href="#optimizing-your-build" title="Direct link to heading">â€‹</a></h3><p>::: warning NOTE You will need <a href="https://www.docker.com" target="_blank" rel="noopener noreferrer">Docker</a> installed to run this command.
:::</p><p>You will need to make sure the output WASM binary is as small as possible in order to minimize fees and stay under the
size limit for the blockchain. Run the following command in the root directory of your Rust smart contract&#x27;s project
folder.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">docker run --rm -v &quot;$(pwd)&quot;:/code \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --mount type=volume,source=&quot;$(basename &quot;$(pwd)&quot;)_cache&quot;,target=/code/target \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --mount type=volume,source=registry_cache,target=/usr/local/cargo/registry \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cosmwasm/rust-optimizer:0.12.0</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This will result in an optimized build of <code>artifacts/my_first_contract.wasm</code> in your working directory.</p><p>(Optional) Add the above command in <code>Cargo.toml</code> for quick access.</p><p>This allows the run custom script commands in a similar way as <code>package.json</code> in the Node ecosystem.</p><p>Install <code>cargo-run-script</code></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cargo install cargo-run-script</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Add the script in <code>Cargo.toml</code></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI toml"><pre tabindex="0" class="prism-code language-toml codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[package.metadata.scripts]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">optimize = &quot;&quot;&quot;docker run --rm -v &quot;$(pwd)&quot;:/code \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --mount type=volume,source=&quot;$(basename &quot;$(pwd)&quot;)_cache&quot;,target=/code/target \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --mount type=volume,source=registry_cache,target=/usr/local/cargo/registry \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cosmwasm/rust-optimizer:0.12.0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;&quot;&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Run the command:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cargo run-script optimize</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="schemas">Schemas<a aria-hidden="true" class="hash-link" href="#schemas" title="Direct link to heading">â€‹</a></h2><p>In order to make use of JSON-schema auto-generation, we should register each of the data structures that we need schemas
for.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI rust"><pre tabindex="0" class="prism-code language-rust codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// examples/schema.rs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use std::env::current_dir;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use std::fs::create_dir_all;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use cosmwasm_schema::{export_schema, remove_schemas, schema_for};</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use my_first_contract::msg::{CountResponse, ExecuteMsg, InstantiateMsg, QueryMsg};</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use my_first_contract::state::State;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fn main() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  let mut out_dir = current_dir().unwrap();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  out_dir.push(&quot;schema&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  create_dir_all(&amp;out_dir).unwrap();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  remove_schemas(&amp;out_dir).unwrap();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  export_schema(&amp;schema_for!(InstantiateMsg), &amp;out_dir);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  export_schema(&amp;schema_for!(ExecuteMsg), &amp;out_dir);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  export_schema(&amp;schema_for!(QueryMsg), &amp;out_dir);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  export_schema(&amp;schema_for!(State), &amp;out_dir);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  export_schema(&amp;schema_for!(CountResponse), &amp;out_dir);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>You can then build the schemas with:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cargo schema</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Your newly generated schemas should be visible in your <code>schema/</code> directory. The following is an example
of <code>schema/query_msg.json</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;$schema&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;http://json-schema.org/draft-07/schema#&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;title&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;QueryMsg&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;anyOf&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;type&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;object&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;required&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;get_count&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;properties&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;get_count&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;type&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;object&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;additionalProperties&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>You can use an online tool such as <a href="https://www.jsonschemavalidator.net/" target="_blank" rel="noopener noreferrer">JSON Schema Validator</a> to test your input
against the generated JSON schema.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/InterWasm/docs/edit/main/dev-academy/develop-smart-contract/01-intro.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/dev-academy/capture-the-flag/hints"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Hints</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/dev-academy/develop-smart-contract/develop"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Develop Contract<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#start-with-a-template" class="table-of-contents__link toc-highlight">Start with a template</a></li><li><a href="#contract-state" class="table-of-contents__link toc-highlight">Contract State</a></li><li><a href="#instantiatemsg" class="table-of-contents__link toc-highlight">InstantiateMsg</a><ul><li><a href="#example" class="table-of-contents__link toc-highlight">Example</a></li><li><a href="#message-definition" class="table-of-contents__link toc-highlight">Message Definition</a></li><li><a href="#logic" class="table-of-contents__link toc-highlight">Logic</a></li></ul></li><li><a href="#executemsg" class="table-of-contents__link toc-highlight">ExecuteMsg</a><ul><li><a href="#example-1" class="table-of-contents__link toc-highlight">Example</a></li><li><a href="#message-definition-1" class="table-of-contents__link toc-highlight">Message Definition</a></li><li><a href="#logic-1" class="table-of-contents__link toc-highlight">Logic</a></li></ul></li><li><a href="#querymsg" class="table-of-contents__link toc-highlight">QueryMsg</a><ul><li><a href="#example-2" class="table-of-contents__link toc-highlight">Example</a></li><li><a href="#message-definition-2" class="table-of-contents__link toc-highlight">Message Definition</a></li><li><a href="#logic-2" class="table-of-contents__link toc-highlight">Logic</a></li></ul></li><li><a href="#building-the-contract" class="table-of-contents__link toc-highlight">Building the Contract</a><ul><li><a href="#optimizing-your-build" class="table-of-contents__link toc-highlight">Optimizing your build</a></li></ul></li><li><a href="#schemas" class="table-of-contents__link toc-highlight">Schemas</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Related Documentation</div><ul class="footer__items"><li class="footer__item"><a href="https://cosmos.network/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Cosmos SDK<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://hub.cosmos.network/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Cosmos Hub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://docs.tendermint.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Tendermint Core<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Repositories</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/CosmWasm/cosmwasm" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>CosmWasm/cosmwasm<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/CosmWasm/wasmd" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>CosmWasm/wasmd<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/CosmWasm/cw-plus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>CosmWasm/cw-plus<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/InterWasm/cw-contracts" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>InterWasm/cw-contracts<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/InterWasm/cw-awesome" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>InterWasm/cw-awesome<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://medium.com/cosmwasm" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://docs.cosmwasm.com/chat/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/CosmWasm" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/InterWasm" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>InterWasm<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://cosmwasm.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_SRtH"><img src="/img/logo_stacked.png" alt="CosmWasm Logo" class="themedImage_TMUO themedImage--light_4Vu1 footer__logo"><img src="/img/logo_stacked.png" alt="CosmWasm Logo" class="themedImage_TMUO themedImage--dark_uzRr footer__logo"></a></div><div class="footer__copyright">Copyright Â© 2021 CosmWasm</div></div></div></footer></div>
<script src="/assets/js/runtime~main.c9b17ae1.js"></script>
<script src="/assets/js/main.6f5058bf.js"></script>
</body>
</html>